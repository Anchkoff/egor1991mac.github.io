!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ExternalSvgPolyfill=t()}(this,function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};return function(){function t(t){this.defaults={target:"svg use",context:window.document.body||window.document.documentElement,root:window.document.body||window.document.documentElement,run:!0,prefix:!0,detect:!0,observe:!0,crossdomain:!0,namespace:"external-svg-polyfill",agents:[/msie|trident/i,/edge\/12/i,/ucbrowser\/11/i]},this.options=e({},this.defaults,t),this.cache={files:new Map,elements:new Map},this.handler={viewportChange:this.onViewportChange.bind(this),documentChange:this.onDocumentChanged.bind(this)},this.observer=new MutationObserver(this.handler.documentChange),this.parser=window.document.createElement("a"),this.process=!this.options.detect||this.detect(),this.options.run&&this.run()}return t.prototype.run=function(){this.updateElements(),this.options.observe&&this.observe()},t.prototype.detect=function(){return this.options.agents.some(function(e){return e.test(window.navigator.userAgent)})},t.prototype.observe=function(){this.observer.observe(this.options.context,{childList:!0,subtree:!0}),window.addEventListener("resize",this.handler.viewportChange),window.addEventListener("orientationchange",this.handler.viewportChange)},t.prototype.unobserve=function(){this.observer.disconnect(),window.removeEventListener("resize",this.handler.viewportChange),window.removeEventListener("orientationchange",this.handler.viewportChange)},t.prototype.destroy=function(){var e=this;this.unobserve(),this.cache.elements.forEach(function(t,n){e.dispatchEvent(n,"revoke",{value:t},function(){e.renderFrame(function(){e.setLinkAttribute(n,t),e.cache.elements.delete(n)})})}),this.cache.files.forEach(function(t,n){t&&e.dispatchEvent(t,"remove",{address:n},function(){e.renderFrame(function(){return e.options.root.removeChild(t)}),e.cache.files.delete(n)})})},t.prototype.updateElements=function(){var e="string"==typeof this.options.target?[].slice.call(this.options.context.querySelectorAll(this.options.target)):this.options.target;Array.from(e).forEach(this.processElement.bind(this))},t.prototype.processElement=function(e){var t=this,n=e.getAttribute("href")||e.getAttribute("xlink:href");if(n&&!n.startsWith("#")&&!this.cache.elements.has(e)&&(this.parser.href=n,this.process||this.options.crossdomain&&window.location.origin!==this.parser.origin)){var i=this.parser.href.split("#")[0],o=this.generateIdentifier(this.parser.hash,this.parser.pathname);i&&!this.cache.files.has(i)&&this.dispatchEvent(e,"load",{address:i},function(){t.cache.files.set(i,null),t.loadFile(i)}),this.dispatchEvent(e,"apply",{address:i,identifier:o},function(){t.renderFrame(function(){t.setLinkAttribute(e,"#"+o),t.cache.elements.set(e,n)})})}},t.prototype.loadFile=function(e){var t=this,n=new XMLHttpRequest;n.addEventListener("load",function(n){return t.onFileLoaded.call(t,n,e)}),n.open("get",e),n.responseType="document",n.send()},t.prototype.generateIdentifier=function(e,t){return e=e.replace("#",""),t=t.replace(/^\//,"").replace(/\.svg$/,"").replace(/[^a-zA-Z0-9]/g,"-"),this.options.prefix?t+"-"+e:e},t.prototype.dispatchEvent=function(e,t,n,i){var o=window.document.createEvent("CustomEvent");o.initCustomEvent(this.options.namespace+"."+t,!0,!0,n),e.dispatchEvent(o),!o.defaultPrevented&&i&&i()},t.prototype.renderFrame=function(e){window.requestAnimationFrame(e.bind(this))},t.prototype.setLinkAttribute=function(e,t){e.hasAttribute("href")&&e.setAttribute("href",t),e.hasAttribute("xlink:href")&&e.setAttribute("xlink:href",t)},t.prototype.prefixValues=function(e,t){var n=this;[].slice.call(e.querySelectorAll("[id]")).forEach(function(i){var o=i.getAttribute("id"),r=n.generateIdentifier(o,t);i.setAttribute("id",r),[].slice.call(e.querySelectorAll('[fill="url(#'+o+')"]')).forEach(function(e){e.setAttribute("fill","url(#"+r+")")})})},t.prototype.onDocumentChanged=function(){this.updateElements()},t.prototype.onViewportChange=function(){this.updateElements()},t.prototype.onFileLoaded=function(e,t){var n=this,i=e.target.response.documentElement;i.setAttribute("aria-hidden","true"),i.style.position="absolute",i.style.overflow="hidden",i.style.width=0,i.style.height=0,this.cache.files.set(t,i),this.options.prefix&&(this.parser.href=t,this.prefixValues(i,this.parser.pathname)),this.dispatchEvent(this.options.root,"insert",{address:t,file:i},function(){n.renderFrame(function(){n.options.root.insertAdjacentElement("afterbegin",i)})})},t}()});
//# sourceMappingURL=bundle.min.js.map
